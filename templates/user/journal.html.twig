{% extends "inline.html.twig" %}

{% block main %}

	<div class="container-fluid d-flex flex-wrap justify-content-center text-center mt-5 px-0">
		<div
			class="col-md-4 col-sm-12 mb-5">
			{# ------------------------------------------------------ Prochaine Invitation ------------------------------------------------------ #}
			<div class="row">
				{% if app.user.invitations is empty %}
					<div class="cards shadows">
						<div class="cardHeader col-12 bgColorOne">
							<p>Prochaine invitation</p>
						</div>

						<div class="cardBody col-12">
							<p class="my-3">
								Vous n'avez pas d'invitation.</p>
							<p class="my-3">votre prochaine invitation apparaitra ici!</p>
						</div>

						<div class="cardFooter col-12">
							<div class="row"></div>
						</div>
					</div>
				{% elseif app.user.invitations is not empty %}
					{% set break = false %}
					{% for invitation in app.user.invitations | sort ((a, b) => a.event.date <=> b.event.date ) %}
						{% if invitation.accepted == true and invitation.refused == false and (invitation.event.date > date('now')) and break == false %}
							<div class="cards shadows">
								<div class="cardHeader bgColorOne">
									<p>Prochaine invitation</p>
								</div>

								<div class="cardBody col-12">
									<p class="card-title text-muted">Organisé par :
										{{invitation.event.owner.firstName|title}}</p>
									<p>Theme:
										{{invitation.event.theme}}</p>
									<p class="card-title">Le
										{{invitation.event.date|format_datetime('full','short', locale='fr')}}</p>
								</div>
								<div class="cardFooter col-12">
									<div class="row">
										<div class="col-6 leftBtn bgColorOne">
											<a href="{{path('contribution_add',{'eventId':invitation.event.id})}}">Contribuer</a>
										</div>
										<div class="col-6 rightBtn bgColorOne">
											<a href="{{path("invitation_showAll")}}">Autres invitations</a>
										</div>
									</div>
								</div>
							</div>
							{% set break = true %}
						{% endif %}
					{% endfor %}
				{% endif %}
			</div>

			{# ------------------------------------------------------ Prochaine organisation ------------------------------------------------------ #}

			<div class="row mt-5">

				{% if app.user.events is empty %}
					<div class="cards shadows">
						<div class="cardHeader col-12 bgColorTwo">
							<p>Ma prochaine organisation</p>
						</div>
						<div class="cardBody col-12">
							<p class="my-3">
								Vous n'avez pas d'organisation en cours!</p>
							<p class="my-3">votre prochaine organisation apparaitra ici!</p>
						</div>

						<div class="cardFooter col-12">
							<div class="row"></div>
						</div>
					</div>
				{% else %}
					{% set break = false %}
					{% for event in app.user.events | sort((a, b) => a.date <=> b.date) %}
						{% if (event.date > date('now')) and break == false %}
							<div class="cards shadows">
								<div class="cardHeader col-12 bgColorTwo">
									<p>Ma prochaine organisation</p>
								</div>

								<div class="cardBody col-12">
									<p class='pt-1'>theme :
										{{event.theme}}</p>
									<p class="card-title">Le
										{{event.date|format_datetime('full','short', locale='fr')}}</p>
									<a href="{{path('contribution_add',{'eventId':event.id})}}">
										<p class =" btn validationButton bgColorTwo border-0 text-white">Voir les contributions</p>
									</a>


								</div>

								<div class="cardFooter col-12">
									<div class="row">
										<div class="col-6 leftBtn bgColorTwo">
											<a href="{{path('guest_add', {'eventId': event.id})}}">Ajouter des invités</a>
										</div>

										<div class="col-6 rightBtn bgColorTwo">
											<a href="{{path("event_show", {'userId': user.id})}}">Tous mes événements</a>
										</div>
									</div>
								</div>
							</div>
							{% set break = true %}
						{% endif %}
					{% endfor %}
				{% endif %}
			</div>
		</div>

		{# ------------------------------------------------------ galerie Photo ------------------------------------------------------ #}

		<div class="col-md-4 col-sm-12  mb-5 galeries">

			<div class="cards shadows col-12">
				<div class="cardHeader">
					<p>Galerie photo</p>
				</div>
				<div class="cardBody">

					<div id="carouselExampleControls" class="carousel slide" data-ride="carousel">

						<div class="carousel-inner">

							{% if user.media is empty %}
								<div class="carousel-item">
									<img src="/uploads/easter.jpg" class="d-block w-100" alt="...">
								</div>
							{% endif %}

							{% for invitation in user.invitations %}
								{% for medium in invitation.event.media %}
									<div class="carousel-item {{ loop.first ? " active" : " " }} ">
										<img src="{{medium.url}}" class="d-block w-100" alt="...">
										<br>
										<p>événement :
											{{invitation.event.theme}}</p>
										<p>Chez :
											{{invitation.event.owner.firstName}}</p>
									</div>
								{% endfor %}
							{% endfor %}

						</div>

						<a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
							<span class="carousel-control-prev-icon" aria-hidden="true"></span>
							<span class="sr-only">Previous</span>
						</a>
						<a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
							<span class="carousel-control-next-icon" aria-hidden="true"></span>
							<span class="sr-only">Next</span>
						</a>
					</div>
				</div>

				<div class="cardFooter">
					<div class="row">
						<div class="bottomBtn bgGrey">
							<a href="">voir plus</a>
						</div>
					</div>
				</div>

			</div>
		</div>

		{# ------------------------------------------------------ Evénement précedement ------------------------------------------------------ #}

		<div class="col-md-4 col-sm-12 mb-5">


			<div>
				{% set invitations = app.user.invitations %}
				{% set invitations = invitations | filter (invitation => invitation.event.date < date('now')) %}
				{% set invitations = invitations | filter (invitation => invitation.accepted) %}
				{% set invitations = invitations | sort ((a, b) => a.event.date <=> b.event.date) %}
				{% set lastInvitation = invitations | first %}

				{% set events = app.user.events %}
				{% set events = events | filter (event => event.date < date('now')) %}
				{% set events = events | sort ((a, b) => a.date <=> b.date) %}
				{% set lastEvent = events | first %}

				<div class="row">

					{% if not lastInvitation and not lastEvent %}

						<div class="cards shadows">
							<div class="cardHeader col-12 bgColorThree">
								<p>Evénement précédent</p>
							</div>

							<div class="cardBody col-12">
								<p class="my-3">
									Pour l'heure, vous n'avez participé à aucun évènement !
								</p>
							</div>

							<div class="cardFooter col-12">
								<div class="row"></div>
							</div>

						</div>
					</div>


				{% else %}

					{% if not lastInvitation %}
						{% set eventDisplay = lastEvent %}

					{% elseif not lastEvent %}
						{% set eventDisplay = lastInvitation.event %}

					{% else %}
						{% set eventDisplay = (lastEvent.date < lastInvitation.event.date ? lastInvitation.event : lastEvent) %}
					{% endif %}

					{# ------------------------------------------------------ boucle sur les invitations ------------------------------------------------------ #}


					<div class="cards shadows">
						<div class="cardHeader col-12 bgColorThree">
							<p>Evénement précédent</p>
						</div>

						<div class="cardBody col-12 text-muted">
							<p>Organisé par :
								{{eventDisplay.owner.firstName|title}}</p>
							<p>Thème :
								{{eventDisplay.theme}}</p>
							<p>Le
								{{eventDisplay.date|format_datetime('full','short', locale='fr')}}</p>
						</div>

						<div class="cardFooter col-12">
							<div class="row">
								<div
									class="col-6 leftBtn {# bgColorThree #} ">{# <a href="">Commenter</a> #}
								</div>
								<div class="col-6 rightBtn bgColorThree">
									<a href="{{path('media_add',{'eventId':eventDisplay.id})}}">Ajouter des images</a>
								</div>
							</div>
						</div>
					</div>
				{% endif %}
			</div>
		</div>

		{# ------------------------------------------------------ the end ------------------------------------------------------ #}
	</div>
{% endblock %}
